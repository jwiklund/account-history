<!doctype html>
<html lang="en">
  {{template "head.html"}}
  <body hx-ext="morph">
    {{block "index.body.html" .}}
    <div class="container" hx-boost="true">
      {{template "nav.html" "index"}}
      <table class="table">
        <tbody>
          {{range .Total}}
          <tr>
            <th scope="row">{{.Name}}</th>
            <td>{{.Value}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
      <div>
        <canvas id="summary"></canvas>
      </div>
      <script>
        var summaryData = {{json .Years}}

        function chart() {
          summaryChart = document.getElementById("summary")
          if (!summaryChart) {
            return
          }
          if (document.currentChart) {
            document.currentChart.destroy()
          }
          document.currentChart = new Chart(summaryChart, {
            type: 'bar',
            data: {
              labels: summaryData.map(x => x.Year),
              datasets: [{
                label: 'Change',
                data: summaryData.map(x => x.Change),
              }, {
                label: 'Increase',
                data: summaryData.map(x => x.Increase),
              }]
            }
         });
        }
        if (document.currentChartFn) {
          document.body.removeEventListener("htmx:load", window.currentChartFn)
        }
        document.body.addEventListener("htmx:load", chart)
        document.currentChartFn = chart
      </script>
    </div>
    {{end}}
    {{template "scripts.html"}}
  </body>
</html>
